<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Model Gallery</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <!-- Load the QRCode library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <!-- External CSS -->
  <link rel="stylesheet" href="css/styles.css">
  <!-- Added styles for mobile deployment UI -->
  <style>
    /* Status message styling */
    #statusMessage {
      margin-top: 10px;
      padding: 8px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
      transition: all 0.3s ease;
    }
    
    /* Mobile deployment button container */
    .modal-button-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }
    
    /* QR code container styling enhancements */
    .qr-container {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      text-align: center;
      max-width: 350px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .qr-container h3 {
      margin-top: 0;
      color: #333;
    }
    
    .qr-container p {
      margin-bottom: 20px;
      color: #666;
      font-size: 14px;
    }
    
    /* Button styling */
    .modal-deploy-btn, .modal-refresh-btn {
      background-color: #4285F4;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
    }
    
    /* Button states */
    .modal-deploy-btn.connecting {
      background-color: #FFA500; /* Orange for connecting */
      position: relative;
      cursor: wait;
    }
    
    .modal-deploy-btn.connecting::after {
      content: "";
      position: absolute;
      width: 100%;
      height: 3px;
      bottom: 0;
      left: 0;
      background: linear-gradient(to right, transparent, white, transparent);
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .modal-deploy-btn.ready {
      background-color: #34A853; /* Green for ready */
    }
    
    .modal-deploy-btn.connected {
      background-color: #4285F4; /* Blue for connected */
    }
    
    .modal-deploy-btn.error {
      background-color: #EA4335; /* Red for error */
    }
    
    .modal-deploy-btn:hover:not(:disabled), .modal-refresh-btn:hover:not(:disabled) {
      filter: brightness(1.1);
      transform: translateY(-1px);
    }
    
    .modal-deploy-btn:disabled {
      opacity: 0.8;
      cursor: not-allowed;
    }
    
    .modal-refresh-btn {
      display: none;
      background-color: #34A853; /* Green for refresh */
    }
    
    /* AR mode selector */
    .ar-mode-selector {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    /* Connection status indicator */
    .connection-status {
      display: inline-flex;
      align-items: center;
      margin-left: 10px;
      font-size: 12px;
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-connected {
      background-color: #34A853;
    }
    
    .status-connecting {
      background-color: #FFA500;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <h1>Space</h1>
  <div class="gallery">
    <!-- Your original model -->
    <div class="model-card" data-model="./models/31_10_2024.glb" data-title="My Model" data-desc="Original 3D model">
      <div class="model-container">
        <model-viewer
          src="./models/31_10_2024.glb"
          alt="Original 3D model"
          auto-rotate
          camera-controls
          shadow-intensity="1">
        </model-viewer>
      </div>
      <div class="model-info">
        <h2>My Model</h2>
        <p>Original 3D model</p>
        <a href="./models/31_10_2024.glb" download class="download-btn">Download</a>
      </div>
    </div>
    
    <!-- Temple model -->
    <div class="model-card" data-model="./models/20230204temple-transformed.glb" data-title="Temple" data-desc="Example 3D model">
      <div class="model-container">
        <model-viewer
          src="./models/20230204temple-transformed.glb"
          alt="Temple"
          auto-rotate
          camera-controls
          shadow-intensity="1">
        </model-viewer>
      </div>
      <div class="model-info">
        <h2>Temple</h2>
        <p>Example 3D model</p>
        <a href="./models/20230204temple-transformed.glb" download class="download-btn">Download</a>
      </div>
    </div>
    
    <!-- Hibiscus model -->
    <div class="model-card" data-model="./models/hibiscus.glb" data-title="Hibiscus" data-desc="Example 3D model">
      <div class="model-container">
        <model-viewer
          src="./models/hibiscus.glb"
          alt="hibiscus"
          auto-rotate
          camera-controls
          shadow-intensity="1">
        </model-viewer>
      </div>
      <div class="model-info">
        <h2>Hibiscus</h2>
        <p>Example 3D model</p>
        <a href="./models/hibiscus.glb" download class="download-btn">Download</a>
      </div>
    </div>

    <!-- Idol model from external source -->
    <div class="model-card" data-model="https://cdn.glitch.me/fe683ccc-7c71-4551-94d5-171a2e238fcf/saraswati_flower.glb" data-title="Idol" data-desc="Saraswati 3D model">
      <div class="model-container">
        <model-viewer
          src="https://cdn.glitch.me/fe683ccc-7c71-4551-94d5-171a2e238fcf/saraswati_flower.glb"
          alt="Idol"
          auto-rotate
          camera-controls
          shadow-intensity="1">
        </model-viewer>
      </div>
      <div class="model-info">
        <h2>Idol</h2>
        <p>Saraswati 3D model</p>
        <a href="https://cdn.glitch.me/fe683ccc-7c71-4551-94d5-171a2e238fcf/saraswati_flower.glb" download class="download-btn">Download</a>
      </div>
    </div>

    <!-- Bicycle model -->
    <div class="model-card" data-model="./models/bycycle.glb" data-title="Bicycle" data-desc="3D bicycle model">
      <div class="model-container">
        <model-viewer
          src="./models/bycycle.glb"
          alt="Bicycle"
          auto-rotate
          camera-controls
          shadow-intensity="1">
        </model-viewer>
      </div>
      <div class="model-info">
        <h2>Bicycle</h2>
        <p>3D bicycle model</p>
        <a href="./models/bycycle.glb" download class="download-btn">Download</a>
      </div>
    </div>
  </div>

  <!-- Modal overlay for enlarged model view -->
  <div class="overlay" id="modelOverlay">
    <div class="modal">
      <button class="close-button" id="closeButton">Ã—</button>
      <model-viewer
        id="modalModelViewer"
        camera-controls
        shadow-intensity="1"
        ar
        ar-modes="webxr scene-viewer quick-look">
      </model-viewer>
      <div class="modal-button-container">
        <a id="modalDownloadBtn" href="#" download class="modal-download-btn">Download</a>
        <button id="modalDeployBtn" class="modal-deploy-btn">
          <span>Deploy to Mobile</span>
        </button>
        <div id="statusMessage"></div>
        <div class="connection-status" id="connectionStatus" style="display: none;">
          <div class="status-indicator"></div>
          <span class="status-text"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- QR Code overlay with enhanced functionality -->
  <div class="qr-overlay" id="qrOverlay">
    <div class="qr-container">
      <h3>Mobile View</h3>
      <p>Scan this QR code with your mobile device to view the model</p>
      <canvas id="qr-code" width="200" height="200"></canvas>
      <p id="qr-url" style="font-size: 12px; word-break: break-all;"></p>
      
      <!-- Mobile refresh button -->
      <button id="refreshMobileBtn" class="modal-refresh-btn">
        Refresh Mobile
      </button>
      
      <!-- AR mode selector -->
      <div class="ar-mode-selector">
        <input type="checkbox" id="arModeSelector" checked>
        <label for="arModeSelector">Default AR Mode to Scene Viewer</label>
      </div>
      
      <div style="margin-top: 15px; font-size: 12px; color: #666;">
        This uses a third-party <a href="https://github.com/nwtgck/piping-server" target="_blank" style="color: #4285F4;">piping server</a> to deploy to your mobile device. This server does not store data.
      </div>
      
      <button class="qr-close" id="qrCloseButton">Close</button>
    </div>
  </div>

  <!-- External JavaScript -->
  <script src="js/gallery.js"></script>
  <script src="js/qr-deploy.js"></script>
</body>
</html>
